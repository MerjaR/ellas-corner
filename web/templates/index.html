<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ella's Corner</title>
    <link rel="stylesheet" href="/static/style.css">
    <!-- Google Fonts link -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Quicksand:wght@500&display=swap" rel="stylesheet">

</head>
<body>
    <!-- Navigation Bar -->
 {{ template "navbar" . }}


    <main>
    <!-- Date filtering -->     
<div class="date-filter-container">
  <form action="/filter" method="GET" class="date-filter-form">
    <label for="start_date">From:</label>
    <input type="date" id="start_date" name="start_date">

    <label for="end_date">To:</label>
    <input type="date" id="end_date" name="end_date">

    <button type="submit">Apply</button>
  </form>
</div>





        <!-- Global Error message section below the filters -->
        {{ if .ErrorMessage }}
        <div class="error-message" style="color: red; text-align: center; margin-top: 10px;">
            <p>{{ .ErrorMessage }}</p>
        </div>
        {{ end }}

        <!-- Display Posts -->
{{ range .Posts }}
<div class="post">
    <h2>{{ .Title }}</h2>
    {{ if .Image }}
    <img src="/static/uploads/{{ .Image }}" alt="Post Image" class="post-image">
    {{ end }}
    <div style="display: flex; align-items: center; gap: 10px;">
        <!-- Profile Picture for Post Author -->
        <img src="/static/profile_pictures/{{ .ProfilePicture }}" alt="Profile Picture" style="width: 40px; height: 40px; border-radius: 50%;">
        <p><strong>Category:</strong> {{ .Category }}</p>
        <p><strong>Posted by {{ .Username }}</strong> on {{ .FormattedCreatedAt }}</p>
    </div>
    <!-- Post Content -->
    <pre style="
    background-color: #f8f4ef;
    border: none;
    font-family: 'Roboto', sans-serif;
    font-size: 16px;
    padding: 15px 30px;
    border-radius: 8px;
    white-space: pre-wrap;
    word-wrap: break-word;
    color: #333;
    margin: 0 20px;">{{ .Content }}</pre>
            
            

            <div class="interaction-bar">
    <!-- Like Button -->
    <form action="/react" method="POST">
        <input type="hidden" name="post_id" value="{{ .ID }}">
        <input type="hidden" name="reaction" value="like">
        <button type="submit" class="reaction-button">
            <img src="/static/like.png" alt="Like" class="reaction-icon {{ if eq .UserReaction "like" }}active-reaction{{ end }}">
        </button>
    </form>
    <span>{{ .Likes }}</span>

    <!-- Dislike Button -->
    <form action="/react" method="POST">
        <input type="hidden" name="post_id" value="{{ .ID }}">
        <input type="hidden" name="reaction" value="dislike">
        <button type="submit" class="reaction-button">
            <img src="/static/dislike.png" alt="Dislike" class="reaction-icon {{ if eq .UserReaction "dislike" }}active-reaction{{ end }}">
        </button>
    </form>
    <span>{{ .Dislikes }}</span>

    <!-- Leave a Comment -->
    {{ if $.isLoggedIn }}
    <a href="/?showCommentFormForPost={{ .ID }}" class="comment-button">Leave a Comment</a>
    {{ end }}
</div>
           <!-- Display Comments Section -->
<div class="comments-section">
    <h3>Comments ({{ len .Comments }}):</h3>

    {{ range .Comments }}
    <div class="comment">
        <div class="comment-header">
            <img src="/static/profile_pictures/{{ .ProfilePicture }}" alt="Profile Picture" class="comment-profile-pic">
            <p><strong>{{ .Username }}</strong> on {{ .FormattedCreatedAt }}</p>
        </div>
        <div class="comment-body">
            <p class="comment-text">{{ .Content }}</p>
        </div>

        <!-- Comment Reactions -->
        <form action="/react-comment" method="POST" style="display:inline-block;">
            <input type="hidden" name="comment_id" value="{{ .ID }}">
            <input type="hidden" name="reaction" value="like">
            <button type="submit" style="border:none; background:none;">
                <img src="/static/like.png" alt="Like" style="width:20px; height:20px;" class="{{ if eq .UserReaction "like" }}active-reaction{{ end }}">
            </button>
        </form>
        <span>{{ .Likes }} Likes</span>

        <form action="/react-comment" method="POST" style="display:inline-block; margin-left: 10px;">
            <input type="hidden" name="comment_id" value="{{ .ID }}">
            <input type="hidden" name="reaction" value="dislike">
            <button type="submit" style="border:none; background:none;">
                <img src="/static/dislike.png" alt="Dislike" style="width:20px; height:20px;" class="{{ if eq .UserReaction "dislike" }}active-reaction{{ end }}">
            </button>
        </form>
        <span>{{ .Dislikes }} Dislikes</span>
    </div>
    {{ end }}

    <!-- Add comment form inside the comments section -->
    {{ if eq $.ShowCommentFormForPost .ID }}
    <form action="/add-comment" method="POST" class="comment-form">
        <input type="hidden" name="post_id" value="{{ .ID }}">
        <textarea name="content" placeholder="Join the conversation" maxlength="2000" rows="6" class="comment-textarea"></textarea>
        <button type="submit" class="comment-submit-button">Comment</button>
    </form>
    {{ end }}
</div>
</div>

        {{ end }}
    </main>

    <!-- Footer -->
    <footer>
        <p>&copy; 2024 Ellaâ€™s Corner. Made with care for new parents.</p>
    </footer>

    <!-- Cookie consent banner -->
    {{ if .ShowConsentBanner }}
    <div id="cookie-banner" class="cookie-banner">
        <img src="/static/cookie.png" alt="Cookie" class="cookie-image">
        <div class="cookie-text">
            <p>This site uses necessary cookies that help it function properly. By continuing to browse, you consent to our use of such cookies.</p>
            <form action="/accept-cookies" method="POST">
                <button type="submit" class="accept-button">I understand!</button>
            </form>
        </div>
    </div>
    {{ end }}

</body>
</html>
